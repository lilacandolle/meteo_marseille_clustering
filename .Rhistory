axis.title.y = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank()
)
b <- ggplot(df_3j, aes(x = heures, y = 0)) +
geom_point() +
geom_segment(aes(xend = heures + windu_era5, yend = windv_era5), y = 0, arrow = arrow()) +
scale_x_continuous(
name = NULL,
limits = xlim_common,
breaks = breaks_major,
minor_breaks = breaks_minor,
labels = function(x) format(min(df_3j$DateTime) + x * 3600,  "%Y-%m-%d %H:%M")
) +
coord_fixed() +
theme_minimal() +
theme(
axis.title.y = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank()
)
c <- ggplot(df_3j, aes(x = heures, y = 0)) +
geom_point() +
geom_segment(aes(xend = heures + windu_era5land, yend = windv_era5land), y = 0, arrow = arrow()) +
scale_x_continuous(
name = NULL,
limits = xlim_common,
breaks = breaks_major,
minor_breaks = breaks_minor,
labels = function(x) format(min(df_3j$DateTime) + x * 3600,  "%Y-%m-%d %H:%M")
) +
coord_fixed() +
theme_minimal() +
theme(
axis.title.y = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank()
)
a / b / c
summary(df_3j$windu_mf)
summary(df_3j$windu_era5)
summary(df_3j$windv_mf)
summary(df_3j$windv_era5)
summary(df_3j$windu_era5land)
summary(df_3j$windv_era5land)
breaks_major <- seq(0, max(df_3j$heures), by = 24)
breaks_minor <- seq(0, max(df_3j$heures), by = 6)
xlim_common <- range(df_3j$heures, na.rm = TRUE)
xlim_common <- c(xlim_common[1] - 1, xlim_common[2] + 6)  # ajoute 3h de marge A MODIFIER SI ERREUR GENRE OUTSIDE THE SCALE RANGE
a <- ggplot(df_3j, aes(x = heures, y = 0)) +
geom_point() +
geom_segment(aes(xend = heures + windu_mf, yend = windv_mf), y = 0, arrow = arrow()) +
scale_x_continuous(
name = NULL,
limits = xlim_common,
breaks = breaks_major,
minor_breaks = breaks_minor,
labels = NULL
) +
coord_fixed() +
theme_minimal() +
theme(
axis.title.y = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank()
)
b <- ggplot(df_3j, aes(x = heures, y = 0)) +
geom_point() +
geom_segment(aes(xend = heures + windu_era5, yend = windv_era5), y = 0, arrow = arrow()) +
scale_x_continuous(
name = NULL,
limits = xlim_common,
breaks = breaks_major,
minor_breaks = breaks_minor,
labels = function(x) format(min(df_3j$DateTime) + x * 3600,  "%Y-%m-%d %H:%M")
) +
coord_fixed() +
theme_minimal() +
theme(
axis.title.y = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank()
)
c <- ggplot(df_3j, aes(x = heures, y = 0)) +
geom_point() +
geom_segment(aes(xend = heures + windu_era5land, yend = windv_era5land), y = 0, arrow = arrow()) +
scale_x_continuous(
name = NULL,
limits = xlim_common,
breaks = breaks_major,
minor_breaks = breaks_minor,
labels = function(x) format(min(df_3j$DateTime) + x * 3600,  "%Y-%m-%d %H:%M")
) +
coord_fixed() +
theme_minimal() +
theme(
axis.title.y = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank()
)
a / b / c
summary(df_3j$windu_mf)
summary(df_3j$windu_era5)
summary(df_3j$windv_mf)
summary(df_3j$windv_era5)
summary(df_3j$windu_era5land)
summary(df_3j$windv_era5land)
library(ggplot2)
library(dplyr)
library(tidyr)
library(lubridate)
library(openair)
library(foehnix)
library(metR)
library(ncdf4)
library(patchwork)
# paramètres pour l'exécution du code
savefig = TRUE
getwd()
breaks_major <- seq(0, max(df_3j$heures), by = 24)
breaks_minor <- seq(0, max(df_3j$heures), by = 6)
xlim_common <- range(df_3j$heures, na.rm = TRUE)
xlim_common <- c(xlim_common[1] - 1, xlim_common[2] + 6)  # ajoute 3h de marge A MODIFIER SI ERREUR GENRE OUTSIDE THE SCALE RANGE
a <- ggplot(df_3j, aes(x = heures, y = 0)) +
geom_point() +
geom_segment(aes(xend = heures + windu_mf, yend = windv_mf), y = 0, arrow = arrow()) +
scale_x_continuous(
name = NULL,
limits = xlim_common,
breaks = breaks_major,
minor_breaks = breaks_minor,
labels = NULL
) +
coord_fixed() +
theme_minimal() +
theme(
axis.title.y = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank()
)
b <- ggplot(df_3j, aes(x = heures, y = 0)) +
geom_point() +
geom_segment(aes(xend = heures + windu_era5, yend = windv_era5), y = 0, arrow = arrow()) +
scale_x_continuous(
name = NULL,
limits = xlim_common,
breaks = breaks_major,
minor_breaks = breaks_minor,
labels = function(x) format(min(df_3j$DateTime) + x * 3600,  "%Y-%m-%d %H:%M")
) +
coord_fixed() +
theme_minimal() +
theme(
axis.title.y = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank()
)
c <- ggplot(df_3j, aes(x = heures, y = 0)) +
geom_point() +
geom_segment(aes(xend = heures + windu_era5land, yend = windv_era5land), y = 0, arrow = arrow()) +
scale_x_continuous(
name = NULL,
limits = xlim_common,
breaks = breaks_major,
minor_breaks = breaks_minor,
labels = function(x) format(min(df_3j$DateTime) + x * 3600,  "%Y-%m-%d %H:%M")
) +
coord_fixed() +
theme_minimal() +
theme(
axis.title.y = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank()
)
a / b / c
summary(df_3j$windu_mf)
summary(df_3j$windu_era5)
summary(df_3j$windv_mf)
summary(df_3j$windv_era5)
summary(df_3j$windu_era5land)
summary(df_3j$windv_era5land)
breaks_major <- seq(0, max(df_3j$heures), by = 24)
breaks_minor <- seq(0, max(df_3j$heures), by = 6)
xlim_common <- range(df_3j$heures, na.rm = TRUE)
xlim_common <- c(xlim_common[1] - 1, xlim_common[2] + 6)  # ajoute 3h de marge A MODIFIER SI ERREUR GENRE OUTSIDE THE SCALE RANGE
a <- ggplot(df_3j, aes(x = heures, y = 0)) +
geom_point() +
geom_segment(aes(xend = heures + windu_mf, yend = windv_mf), y = 0, arrow = arrow()) +
scale_x_continuous(
name = NULL,
limits = xlim_common,
breaks = breaks_major,
minor_breaks = breaks_minor,
labels = NULL
) +
coord_fixed() +
theme_minimal() +
theme(
axis.title.y = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank()
)
b <- ggplot(df_3j, aes(x = heures, y = 0)) +
geom_point() +
geom_segment(aes(xend = heures + windu_era5, yend = windv_era5), y = 0, arrow = arrow()) +
scale_x_continuous(
name = NULL,
limits = xlim_common,
breaks = breaks_major,
minor_breaks = breaks_minor,
labels = function(x) format(min(df_3j$DateTime) + x * 3600,  "%Y-%m-%d %H:%M")
) +
coord_fixed() +
theme_minimal() +
theme(
axis.title.y = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank()
)
c <- ggplot(df_3j, aes(x = heures, y = 0)) +
geom_point() +
geom_segment(aes(xend = heures + windu_era5land, yend = windv_era5land), y = 0, arrow = arrow()) +
scale_x_continuous(
name = NULL,
limits = xlim_common,
breaks = breaks_major,
minor_breaks = breaks_minor,
labels = function(x) format(min(df_3j$DateTime) + x * 3600,  "%Y-%m-%d %H:%M")
) +
coord_fixed() +
theme_minimal() +
theme(
axis.title.y = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank()
)
a / b
summary(df_3j$windu_mf)
summary(df_3j$windu_era5)
summary(df_3j$windv_mf)
summary(df_3j$windv_era5)
summary(df_3j$windu_era5land)
summary(df_3j$windv_era5land)
breaks_major <- seq(0, max(df_3j$heures), by = 24)
breaks_minor <- seq(0, max(df_3j$heures), by = 6)
xlim_common <- range(df_3j$heures, na.rm = TRUE)
xlim_common <- c(xlim_common[1] - 1, xlim_common[2] + 6)  # ajoute 3h de marge A MODIFIER SI ERREUR GENRE OUTSIDE THE SCALE RANGE
a <- ggplot(df_3j, aes(x = heures, y = 0)) +
geom_point() +
geom_segment(aes(xend = heures + windu_mf, yend = windv_mf), y = 0, arrow = arrow()) +
scale_x_continuous(
name = NULL,
limits = xlim_common,
breaks = breaks_major,
minor_breaks = breaks_minor,
labels = NULL
) +
coord_fixed() +
theme_minimal() +
theme(
axis.title.y = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank()
)
b <- ggplot(df_3j, aes(x = heures, y = 0)) +
geom_point() +
geom_segment(aes(xend = heures + windu_era5, yend = windv_era5), y = 0, arrow = arrow()) +
scale_x_continuous(
name = NULL,
limits = xlim_common,
breaks = breaks_major,
minor_breaks = breaks_minor,
labels = function(x) format(min(df_3j$date) + x * 3600,  "%Y-%m-%d %H:%M")
) +
coord_fixed() +
theme_minimal() +
theme(
axis.title.y = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank()
)
c <- ggplot(df_3j, aes(x = heures, y = 0)) +
geom_point() +
geom_segment(aes(xend = heures + windu_era5land, yend = windv_era5land), y = 0, arrow = arrow()) +
scale_x_continuous(
name = NULL,
limits = xlim_common,
breaks = breaks_major,
minor_breaks = breaks_minor,
labels = function(x) format(min(df_3j$date) + x * 3600,  "%Y-%m-%d %H:%M")
) +
coord_fixed() +
theme_minimal() +
theme(
axis.title.y = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank()
)
a / b
summary(df_3j$windu_mf)
summary(df_3j$windu_era5)
summary(df_3j$windv_mf)
summary(df_3j$windv_era5)
summary(df_3j$windu_era5land)
summary(df_3j$windv_era5land)
breaks_major <- seq(0, max(df_3j$heures), by = 24)
breaks_minor <- seq(0, max(df_3j$heures), by = 6)
xlim_common <- range(df_3j$heures, na.rm = TRUE)
xlim_common <- c(xlim_common[1] - 1, xlim_common[2] + 6)  # ajoute 3h de marge A MODIFIER SI ERREUR GENRE OUTSIDE THE SCALE RANGE
a <- ggplot(df_3j, aes(x = heures, y = 0)) +
geom_point() +
geom_segment(aes(xend = heures + windu_mf, yend = windv_mf), y = 0, arrow = arrow()) +
scale_x_continuous(
name = NULL,
limits = xlim_common,
breaks = breaks_major,
minor_breaks = breaks_minor,
labels = NULL
) +
coord_fixed() +
theme_minimal() +
theme(
axis.title.y = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank()
)
b <- ggplot(df_3j, aes(x = heures, y = 0)) +
geom_point() +
geom_segment(aes(xend = heures + windu_era5, yend = windv_era5), y = 0, arrow = arrow()) +
scale_x_continuous(
name = NULL,
limits = xlim_common,
breaks = breaks_major,
minor_breaks = breaks_minor
) +
coord_fixed() +
theme_minimal() +
theme(
axis.title.y = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank()
)
c <- ggplot(df_3j, aes(x = heures, y = 0)) +
geom_point() +
geom_segment(aes(xend = heures + windu_era5land, yend = windv_era5land), y = 0, arrow = arrow()) +
scale_x_continuous(
name = NULL,
limits = xlim_common,
breaks = breaks_major,
minor_breaks = breaks_minor,
labels = function(x) format(min(df_3j$date) + x * 3600,  "%Y-%m-%d %H:%M")
) +
coord_fixed() +
theme_minimal() +
theme(
axis.title.y = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank()
)
a / b /c
summary(df_3j$windu_mf)
summary(df_3j$windu_era5)
summary(df_3j$windv_mf)
summary(df_3j$windv_era5)
summary(df_3j$windu_era5land)
summary(df_3j$windv_era5land)
View(df)
View(df)
#### Meteo France -------
# on charge les données de Météo France
df <- read.csv("data/raw/MeteoFrance/LCPMARVAL_20162025.csv", header = TRUE, sep = ",")
# changer la colonne AAAAMMJJHH en POSIXct
df$date <- as.POSIXct(strptime(as.character(df$AAAAMMJJHH), format = "%Y%m%d%H"), tz = "UTC")
df <- df %>%
select(NUM_POSTE, NOM_USUEL, date, FF, DD, T, PSTAT, RR1, GLO, U)
# on transforme FF et DD en u et v
uv <- ddff2uv(df$DD, df$FF)
df$windu <- uv$u
df$windv <- uv$v
rm(uv)
# on rajoute la colonne flag_dn
df$flag_dn <- case_when(
hour(df$date) %in% 5:7 ~ "matin",
hour(df$date) %in% 17:21 ~ "soir",
TRUE ~ NA_character_
)
# on rajoute la saison
df$saison <- case_when(
month(df$date) == 12 | month(df$date) == 1 | month(df$date) == 2 ~ "DJF",
month(df$date) == 3 | month(df$date) == 4 | month(df$date) == 5 ~ "MAM",
month(df$date) == 6 | month(df$date) == 7 | month(df$date) == 8 ~ "JJA",
month(df$date) == 9 | month(df$date) == 10 | month(df$date) == 11 ~ "SON"
)
df_VAL <- df %>%
filter(NUM_POSTE == 13055029)
df_MAR <- df %>%
filter(NUM_POSTE == 13054001)
df_LCP <- df %>%
filter(NUM_POSTE == 13055001)
rm(df)
# on sauve les df
saveRDS(df_VAL, file = "./data/processed/VAL.rds")
saveRDS(df_MAR, file = "./data/processed/MAR.rds")
saveRDS(df_LCP, file = "./data/processed/LCP.rds")
# on fait en sorte que le wd soit bon aussi quand on exécute chunk by chunk
if (interactive()) {
setwd(rprojroot::find_rstudio_root_file())
}
getwd()
library(ggplot2)
library(dplyr)
library(tidyr)
library(lubridate)
library(openair)
library(foehnix)
library(metR)
library(ncdf4)
library(patchwork)
# paramètres pour l'exécution du code
savefig = TRUE
getwd()
# chargement des données
df_mf <- readRDS("./data/processed/MAR.rds")
df_ERA5 <- readRDS("./data/processed/ERA5_dataset_MAR.rds")
df_ERA5land <- readRDS("./data/processed/ERA5land_df_435_52.rds")
figpath = ("./outputs/figures/comparison_MAR/")
# on prend que les données de 2022 pour les df, jusqu'au 31 décembre 2022 inclus
df_ERA5 <- df_ERA5 %>%
select(-c(datejulian, flag_dn, hour, month, year, saison))
df_ERA5 <- df_ERA5 %>%
filter(date >= as.POSIXct("2022-01-01", tz = "UTC") & date < as.POSIXct("2023-01-01", tz = "UTC")) %>%
rename_with(~ paste0(.x, "_era5"), .cols = -date)
df_ERA5land <- df_ERA5land %>%
select(-c(datejulian, flag_dn, time, saison))
df_ERA5land <- df_ERA5land %>%
filter(date >= as.POSIXct("2022-01-01", tz = "UTC") & date < as.POSIXct("2023-01-01", tz = "UTC")) %>%
rename_with(~ paste0(.x, "_era5land"), .cols = -date)
df_mf <- df_mf %>%
select(-c(NUM_POSTE, NOM_USUEL, flag_dn, saison))
df_mf <- df_mf %>%
filter(date >= as.POSIXct("2022-01-01", tz = "UTC") & date < as.POSIXct("2023-01-01", tz = "UTC")) %>%
rename_with(~ paste0(.x, "_mf"), .cols = -date)
# on joint les toirs
df <- df_mf %>%
left_join(df_ERA5, by = "date") %>%
left_join(df_ERA5land, by = "date")
# on prend 3 jours pour faire des graphiques
df_3j <- df %>%
filter(date >= as.POSIXct("2022-01-10", tz = "UTC") & date < as.POSIXct("2022-01-14", tz = "UTC"))
# on crée une colonne avec les heures dsepuis le début du df
df_3j$heures <- as.numeric(difftime(df_3j$date, min(df_3j$date), units = "hours"))
breaks_major <- seq(0, max(df_3j$heures), by = 24)
breaks_minor <- seq(0, max(df_3j$heures), by = 6)
xlim_common <- range(df_3j$heures, na.rm = TRUE)
xlim_common <- c(xlim_common[1] - 1, xlim_common[2] + 6)  # ajoute 3h de marge A MODIFIER SI ERREUR GENRE OUTSIDE THE SCALE RANGE
a <- ggplot(df_3j, aes(x = heures, y = 0)) +
geom_point() +
geom_segment(aes(xend = heures + windu_mf, yend = windv_mf), y = 0, arrow = arrow()) +
scale_x_continuous(
name = NULL,
limits = xlim_common,
breaks = breaks_major,
minor_breaks = breaks_minor,
labels = NULL
) +
coord_fixed() +
theme_minimal() +
theme(
axis.title.y = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank()
)
b <- ggplot(df_3j, aes(x = heures, y = 0)) +
geom_point() +
geom_segment(aes(xend = heures + windu_era5, yend = windv_era5), y = 0, arrow = arrow()) +
scale_x_continuous(
name = NULL,
limits = xlim_common,
breaks = breaks_major,
minor_breaks = breaks_minor
) +
coord_fixed() +
theme_minimal() +
theme(
axis.title.y = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank()
)
c <- ggplot(df_3j, aes(x = heures, y = 0)) +
geom_point() +
geom_segment(aes(xend = heures + windu_era5land, yend = windv_era5land), y = 0, arrow = arrow()) +
scale_x_continuous(
name = NULL,
limits = xlim_common,
breaks = breaks_major,
minor_breaks = breaks_minor,
labels = function(x) format(min(df_3j$date) + x * 3600,  "%Y-%m-%d %H:%M")
) +
coord_fixed() +
theme_minimal() +
theme(
axis.title.y = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank()
)
a / b /c
summary(df_3j$windu_mf)
summary(df_3j$windu_era5)
summary(df_3j$windv_mf)
summary(df_3j$windv_era5)
summary(df_3j$windu_era5land)
summary(df_3j$windv_era5land)
